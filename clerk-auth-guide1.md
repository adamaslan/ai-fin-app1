# Clerk + Vercel + Next.js + Google OAuth Setup Guide

This guide walks you through setting up Clerk authentication with Google OAuth provider in a Next.js application deployed on Vercel.

## Prerequisites

- Node.js 18+ installed
- A Vercel account
- A Google Cloud project
- A Clerk account

## Step 1: Create a Clerk Account and Project

1. Go to [clerk.com](https://clerk.com) and sign up for a free account
2. Create a new application
3. Select **Next.js** as your framework
4. Choose your preferred sign-in methods (we'll configure Google OAuth)
5. Complete the onboarding process

## Step 2: Set Up Google OAuth Provider

### Create a Google Cloud Project

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Click on the project dropdown and select **New Project**
3. Enter a project name (e.g., "My Next.js App") and click **Create**
4. Wait for the project to be created, then select it

### Enable Google+ API

1. In the Google Cloud Console, go to **APIs & Services** > **Library**
2. Search for "Google+ API"
3. Click on it and press **Enable**

### Create OAuth 2.0 Credentials

1. Go to **APIs & Services** > **Credentials**
2. Click **+ Create Credentials** > **OAuth client ID**
3. If prompted, configure the OAuth consent screen:
   - Choose **External** as the user type
   - Fill in the app name, user support email, and developer contact info
   - On the scopes page, add: `email`, `profile`, `openid`
   - Add test users if needed (your email)
   - Review and create
4. Back on the credentials page, click **+ Create Credentials** > **OAuth client ID** again
5. Select **Web application**
6. Add authorized redirect URIs:
   - `http://localhost:3000/auth/callback/google` (for local development)
   - `https://yourdomain.vercel.app/auth/callback/google` (for production, replace with your domain)
   - `https://yourdomain.vercel.app/auth/google/callback` (alternative format)
7. Click **Create**
8. Copy your **Client ID** and **Client Secret** â€” you'll need these

## Step 3: Configure Clerk with Google OAuth

1. Go to your [Clerk Dashboard](https://dashboard.clerk.com)
2. Select your application
3. Go to **Integrations** or **Social Connections**
4. Find **Google** and click **Connect**
5. Paste your Google Client ID and Client Secret
6. Click **Connect**

## Step 4: Set Up Your Next.js Project

### Create a New Next.js Project

```bash
npx create-next-app@latest my-app --typescript --tailwind
cd my-app
```

### Install Clerk

```bash
npm install @clerk/nextjs
```

### Configure Environment Variables

Create a `.env.local` file in your project root:

```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_publishable_key
CLERK_SECRET_KEY=your_secret_key
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/
```

You can find your keys in the Clerk Dashboard under **API Keys**.

### Update `middleware.ts`

Create or update `middleware.ts` in your project root:

```typescript
import { authMiddleware } from "@clerk/nextjs";

export default authMiddleware({
  publicRoutes: ["/", "/sign-in", "/sign-up"],
});

export const config = {
  matcher: ["/((?!.*\\..*|_next).*)", "/", "/(api|trpc)(.*)"],
};
```

### Update `layout.tsx`

Update your root layout file (`app/layout.tsx`):

```typescript
import { ClerkProvider } from '@clerk/nextjs'
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: "My App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body>{children}</body>
      </html>
    </ClerkProvider>
  );
}
```

### Create Sign-In Page

Create `app/sign-in/[[...index]]/page.tsx`:

```typescript
import { SignIn } from "@clerk/nextjs";

export default function SignInPage() {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <SignIn />
    </div>
  );
}
```

### Create Sign-Up Page

Create `app/sign-up/[[...index]]/page.tsx`:

```typescript
import { SignUp } from "@clerk/nextjs";

export default function SignUpPage() {
  return (
    <div className="flex items-center justify-center min-h-screen">
      <SignUp />
    </div>
  );
}
```

### Create a Protected Page

Create `app/dashboard/page.tsx`:

```typescript
import { auth, currentUser } from "@clerk/nextjs";
import { redirect } from "next/navigation";

export default async function DashboardPage() {
  const { userId } = await auth();

  if (!userId) {
    redirect("/sign-in");
  }

  const user = await currentUser();

  return (
    <div className="p-8">
      <h1 className="text-3xl font-bold">Welcome, {user?.firstName}!</h1>
      <p className="text-gray-600 mt-2">Email: {user?.emailAddresses[0]?.emailAddress}</p>
    </div>
  );
}
```

### Update Home Page

Update `app/page.tsx`:

```typescript
import { auth, currentUser } from "@clerk/nextjs";
import Link from "next/link";

export default async function Home() {
  const { userId } = await auth();
  const user = await currentUser();

  return (
    <main className="flex min-h-screen flex-col items-center justify-center p-24">
      <div className="text-center">
        <h1 className="text-4xl font-bold mb-4">Welcome to My App</h1>
        
        {userId ? (
          <div>
            <p className="text-xl mb-4">Hello, {user?.firstName}!</p>
            <Link
              href="/dashboard"
              className="px-6 py-2 bg-blue-600 text-white rounded-lg mr-4"
            >
              Go to Dashboard
            </Link>
            <Link
              href="/sign-out"
              className="px-6 py-2 bg-gray-600 text-white rounded-lg"
            >
              Sign Out
            </Link>
          </div>
        ) : (
          <div>
            <Link
              href="/sign-in"
              className="px-6 py-2 bg-blue-600 text-white rounded-lg mr-4"
            >
              Sign In
            </Link>
            <Link
              href="/sign-up"
              className="px-6 py-2 bg-green-600 text-white rounded-lg"
            >
              Sign Up
            </Link>
          </div>
        )}
      </div>
    </main>
  );
}
```

## Step 5: Test Locally

```bash
npm run dev
```

Visit `http://localhost:3000` and test the sign-in/sign-up flow with your Google account.

## Step 6: Deploy to Vercel

### Push to Git

```bash
git add .
git commit -m "Add Clerk authentication"
git push origin main
```

### Deploy

1. Go to [vercel.com](https://vercel.com) and sign in
2. Click **Add New** > **Project**
3. Select your repository
4. Click **Import**
5. Add environment variables:
   - `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`
   - `CLERK_SECRET_KEY`
   - `NEXT_PUBLIC_CLERK_SIGN_IN_URL`
   - `NEXT_PUBLIC_CLERK_SIGN_UP_URL`
   - `NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL`
   - `NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL`
6. Click **Deploy**

### Update Google OAuth Redirect URIs

1. Go back to Google Cloud Console
2. Update the OAuth consent screen and credentials with your Vercel domain:
   - `https://yourproject.vercel.app/auth/callback/google`

## Troubleshooting

### "Redirect URI mismatch" error

- Ensure your redirect URIs in Google Cloud Console match your application URL
- For local development, use `http://localhost:3000`
- For production, use your Vercel domain

### Missing environment variables

- Double-check that all environment variables are set in `.env.local` (local) and Vercel dashboard (production)
- Environment variables starting with `NEXT_PUBLIC_` are exposed to the browser

### Google sign-in not appearing

- Verify that Google OAuth is connected in Clerk Dashboard
- Clear browser cache and restart dev server
- Check that your Google project has Google+ API enabled

## Additional Resources

- [Clerk Documentation](https://clerk.com/docs)
- [Clerk Next.js Guide](https://clerk.com/docs/quickstarts/nextjs)
- [Google OAuth Documentation](https://developers.google.com/identity/protocols/oauth2)
- [Vercel Documentation](https://vercel.com/docs)

## Next Steps

- Add more OAuth providers (GitHub, Discord, etc.)
- Implement custom sign-in flow
- Set up webhooks for user events
- Add database integration for user profiles